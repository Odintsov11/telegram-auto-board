#!/bin/bash

echo "ðŸš€ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° TG-AUTO..."

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð°
if [ ! -f ".env" ]; then
    cp .env.example .env
    echo "âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½ .env Ñ„Ð°Ð¹Ð»"
    echo "âš ï¸  ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ .env Ñ„Ð°Ð¹Ð» Ñ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸!"
fi

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env.local Ð´Ð»Ñ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð°
if [ ! -f "frontend/.env.local" ]; then
    cat > frontend/.env.local << 'EOF'
NEXT_PUBLIC_API_URL=http://localhost:3001/api
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=development-secret
EOF
    echo "âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½ frontend/.env.local"
fi

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
npm install

cd frontend
npm install
cd ..

cd backend
npm install
npx prisma generate
cd ..

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹
mkdir -p logs uploads

# Ð—Ð°Ð¿ÑƒÑÐº PostgreSQL
echo "ðŸ˜ Ð—Ð°Ð¿ÑƒÑÐº PostgreSQL..."
docker-compose up -d postgres redis

echo "â³ ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."
sleep 10

# ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
echo "ðŸ—„ï¸ ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹..."
cd backend
npx prisma migrate dev --name init
cd ..

echo "âœ… ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!"
echo ""
echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
echo "1. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ .env Ñ„Ð°Ð¹Ð» Ñ Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð¼ Ð±Ð¾Ñ‚Ð°"
echo "2. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: npm run dev"
echo "3. Frontend: http://localhost:3000"
echo "4. Backend: http://localhost:3001"